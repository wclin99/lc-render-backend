<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fetch Data</title>
    <script>
     document.addEventListener('DOMContentLoaded', async function () {
            const userIdSelect = document.getElementById('user-id');
            const sessionIdSelect = document.getElementById('session-id');

            // 初始化 user-id 下拉框
            const allUserIds = await fetch('/fetch_all_user_ids')
                .then(response => response.json());

            allUserIds.forEach(userId => {
                const option = document.createElement('option');
                option.value = userId;
                option.textContent = userId;
                userIdSelect.appendChild(option);
            });

            // 定义一个函数来更新 session-id 下拉框
            const updateSessionIds = async (userId) => {
                // 获取对应的 session-id
                const sessionIds = await fetch(`/fetch_sessions_by_user_id?user_id=${userId}`)
                    .then(response => response.json());

                // 清空 session-id 下拉框
                sessionIdSelect.innerHTML = '';

                // 填充 session-id 下拉框
                sessionIds.forEach(sessionId => {
                    const option = document.createElement('option');
                    option.value = sessionId;
                    option.textContent = sessionId;
                    sessionIdSelect.appendChild(option);
                });
            };

            // 监听 user-id 下拉框的变化
            userIdSelect.addEventListener('change', async function () {
                const selectedUserId = userIdSelect.value;
                await updateSessionIds(selectedUserId);
            });

            // 初始加载时，选择第一个用户并更新 session-id 下拉框
            if (allUserIds.length > 0) {
                userIdSelect.value = allUserIds[0];
                await updateSessionIds(allUserIds[0]);
            }
        });
    </script>
  </head>
  <body>
    <h1>Fetch Data</h1>

    <label for="user-id">User ID:</label>
    <select id="user-id"></select>

    <label for="session-id">Session ID:</label>
    <select id="session-id"></select>
  </body>
</html>
